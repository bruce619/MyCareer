{% extends 'base.html' %}
{% block title %}Job Detail{% endblock %}
{% load static %}
{% load is_already_applied %}


{% block content %}
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissable">
            <a href="{% url 'job-detail' job.id  %}" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                {{ message }}
        </div>
    {% endfor %}
{% endif %}
{% include 'sidebar.html' %}
      <section class="site-section">
      <div class="container">
        <div class="row align-items-center mb-5">
          <div class="col-lg-8 mb-4 mb-lg-0">
            <div class="d-flex align-items-center">
              <div class="border p-2 d-inline-block mr-3z rounded">
                <img src="{{ object.user.profile.image.url }}" alt="Free Website Template By Free-Template.co">
              </div>
              <div>
                <h2>{{ object.title }}</h2>
                <div>
                  <span class="m-2"><i class="fa fa-clock"></i>{{ object.date|date:"F d, Y" }}</span>
                  <span class="m-2"><span class="fa fa-map-marker-alt"></span>{{ object.location }}</span>
                    {% if object.type == 'Full time' %}
                  <span class="badge featured-badge badge-success">Full time</span>
                     {% elif object.type == 'Part time' %}
                  <span class="badge featured-badge badge-primary">Part time</span>
                  {% elif object.type == 'Internship' %}
                  <span class="badge featured-badge badge-warning">Internship</span>
                  {% else %}
                    <span style="color: #ffffff;" class="badge featured-badge badge-warning">Contract</span>
                {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-8">
            <div class="mb-5">
              <figure class="mb-5"><img src="{% static 'img/job_single_img_1.jpg' %}" alt="Free Website Template by Free-Template.co" class="img-fluid rounded"></figure>
              <h3 class="h5 d-flex align-items-center mb-4 text-primary"><i class="fa fa-bars"></i>Job Description</h3>
              <p>{{ object.description }}</p>
            </div>
            <div class="mb-5">
              <h3 class="h5 d-flex align-items-center mb-4 text-primary"><i class="fa fa-rocket"></i>Responsibilities</h3>
              <p>{{ object.requirement }}</p>
            </div>

            {% if in_group %}
                <div class="content-section col-md-12">
                    {% if job.filled %}
                        <input type="button" class="btn btn-outline-white-primary" value="This Position is Filled"/>
                    {% else %}
                        {% is_already_applied job request.user as is_applied %}
                        {% if is_applied %}
                            <input type="button" class="btn btn-outline-white-primary" value="Already applied"/>
                        {% else %}
                            <form action="{% url 'apply-job' job.id %}" method="post" enctype="multipart/form-data">
                                {% csrf_token %}
                              <fieldset class="form-group">
                                <legend class="border-bottom mb-4" style="text-align: center;">Apply Now</legend>
                                   Degree: <select name="degree" class="form-control" required>
                                              <option selected disabled value="Choose">Choose...</option>
                                              <option value="B.Sc">Bachelor's Degree</option>
                                              <option value="M.Sc">Master's Degree</option>
                                              <option value="PhD">Doctorate Degree</option>
                                          </select>
                                  Years of Experience: <input type="number" class="form-control"  name="experience" required>
                                  Upload CV: <input type="file" class="form-control" name="cv" required>
                                  Upload Certification if any: <input type="file" name="certification" class="form-control">
                                  Certification Start Date: <input type="date" name="start_date" class="form-control">
                                  Certification End Date: <input type="date" name="end_date" class="form-control">
                                  <input type="hidden" name="job" value="{{ job.id }}">
                              </fieldset>
                              <div class="form-group">
                                <input type="submit" class="btn btn-block btn-primary btn-md" value="Apply for this job"/>
                              </div>
                            </form>
                        {% endif %}
                    {% endif %}
                </div>
            {% else %}
                  {% if request.user.is_authenticated %}

                  {% else %}
                     <button class="btn btn-outline-white-primary"><a href="{% url 'login' %}">Log in to apply for this role</a></button>
                  {% endif %}
            {% endif %}

          </div>
          <div class="col-lg-4">
            <div class="bg-light p-3 border rounded mb-4">
              <h3 class="text-primary  mt-3 h5 pl-3 mb-3 ">Job Summary</h3>
              <ul class="list-unstyled pl-3 mb-0">
                <li class="mb-2"><strong class="text-black">Employment Status:</strong> {{object.type}}</li>
                <li class="mb-2"><strong class="text-black">Job Location:</strong> {{object.location}}</li>
                <li class="mb-2"><strong class="text-black">Application Deadline:</strong> {{ object.last_date }}</li>
              </ul>
            </div>
          </div>
        </div>
          {% if object.user == user %}
            <div>
            <a class="btn btn-danger btn-sm mt-1 mb-1" href="{% url 'job-delete' job.id %}">Delete</a>
            <a class="btn btn-warning btn-sm mt-1 mb-1" href="{% url 'job-update' job.id %}">Update</a>
            </div>
          {% endif %}
    </div>
</section>

  </div>
</div>
{% endblock %}